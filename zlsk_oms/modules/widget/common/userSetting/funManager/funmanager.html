<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>功能权限配置</title>
    <link rel="stylesheet" href="../../../../../lib/ok_admin/css/okadmin.css">
    <script type="text/javascript" src="../../../../../lib/ok_admin/lib/layui/layui.js"></script>
</head>
<body  style="overflow: hidden">
<div class="commonOutCss">
    <table id="treeTable" lay-filter="treeTable"></table>
</div>
<script>
    var ptable = null, treeGrid = null, tableId = 'treeTable', layer = null, okLayer = null,parentFlag = 0;
    var $;
    layui.use(['treeGrid', 'layer', 'constantUrl', 'dltable', "okLayer", 'zTreeGrid'], function () {
        $ = layui.jquery;
        treeGrid = layui.treeGrid;
        layer = layui.layer;
        okLayer = layui.okLayer;
        var constantUrl = layui.constantUrl;
        var zTreeGrid = layui.zTreeGrid({
            id: tableId
            , elem: '#' + tableId
            , idField: 'ID'
            , treeId: 'ID'//树形id字段名称
            , treeUpId: 'PARENTID'//树形父id字段名称
            , treeShowName: 'NAME'//以树形式显示的字段
            , url: constantUrl.stAuth.selectFun
            , parseData: function (res) {
                return {
                    "code": res.meow,
                    "msg": res.msg,
                    "count": res.data.total,
                    "data": res.data.getMe
                };
            }
            , cols: [[
            {field: 'NAME',  title: '功能管理'},
            {field: 'CODE',  title: '功能编号'},
            {field: 'person',  title: '角色'},
            {
                width: 100, title: '操作', align: 'center'/*toolbar: '#barDemo'*/
                , templet: function (d) {
                var addBtn = '';
                if (d.PARENTID !== -1) {
                    addBtn = '<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">编辑</a>';
                }
                return addBtn;
            }
            }
        ]]
        });

        zTreeGrid.getTreeGrid();

        zTreeGrid.getLayuiTreeGrid().on('tool(' + tableId + ')', function (obj) {
            if (obj.event === "edit") {
                parentFlag = 0;
                edit(obj);
            }
        });
    });

    function reload() {
        treeGrid.reload(tableId, {
            page: {
                curr: 1
            }
        });
    }

    var edit = function (obj) {
        okLayer.open("编辑权限", "funEdit.html", "30%", "60%", function (layero) {
            var iframeWin = window[layero.find("iframe")[0]["name"]];
            iframeWin.initForm( obj.data,false);
        }, function () {
            if (parentFlag === 1){
                reload()
            }
        })
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>埋深</title>
    <link rel="stylesheet" href="../../../../lib/ok_admin/css/okadmin.css">
    <script type="text/javascript" src="../../../../lib/ok_admin/lib/layui/layui.js"></script>
</head>
<body>
<div class="layui-body commonOutCss" style="left: 0">
    <div id="divdepthList" style="display: none">
        <table class="layui-hide"  id="depthList" lay-filter="depthList"></table>
    </div>
    <div id="divhorizontalList" style="display: none">
        <table class="layui-hide" id="horizontalList" lay-filter="horizontalList"></table>
    </div>
</div>
<script type="text/html" id="toolbarV">
    <form class="layui-form layui-col-md12" lay-filter="addV">
        <button class="layui-btn"  title="添加">
            添加
            <i class="layui-icon  ">&#58964;</i>
        </button>
    </form>
</script>
<script type="text/html" id="toolbarH">
    <form class="layui-form layui-col-md12" lay-filter="addH">
        <button class="layui-btn  " title="添加">
            添加
            <i class="layui-icon">&#58964;</i>
        </button>
    </form>
</script>
<script>
    var $;
    var layer;
    var form;
    var table;
    var okLayer;
    var okUtils;
    var constantUrl;

    var  ck;
    var  type;
    var parentBFlag;
    layui.use(['form', 'okUtils', "okLayer", "layer", 'constantUrl', 'table', 'zTable'],function () {
        $ = layui.$ ;
        layer = layui.layer ;
        form = layui.form ;
        table = layui.table ;
        okLayer = layui.okLayer ;
        okUtils = layui.okUtils ;
        constantUrl = layui.constantUrl ;

        ck = okUtils.getUrlParameter('ck');
        type = okUtils.getUrlParameter('type');

        getData();

        form.on('submit(addV)',function (data) {
            addData();
            return false;
        });

        form.on('submit(addH)',function (data) {
            addData();
            return false;
        })
    });

    function addData() {
        parentBFlag = 0;
        okLayer.open("添加", "fieldMappingSpaceForm.html?type=" + type + "&ck=" + ck , "90%", "90%", function (layero) {
        }, function () {
            if (parentBFlag === 1){
                getData();
            }
        });
    }

    function getData() {
        let url = constantUrl.stMap.easySelect;
        let param = {};
        let paramTmpl = {};
        switch (type) {
            case 'depth':
                param = {table:'zlsk_ps_dc',mapStr: JSON.stringify({ck:ck})};
                paramTmpl = {table:'zlsk_ps_dc_tmpl'};
                break;
            case 'horizontal':
                param = {table:'zlsk_ps_hdc',mapStr: JSON.stringify({ck:ck})};
                paramTmpl = {table:'zlsk_ps_hdc_tmpl'};
                break;
            case 'vertical':
                param = {table:'zlsk_ps_vdc',mapStr: JSON.stringify({ck:ck})};
                paramTmpl = {table:'zlsk_ps_vdc_tmpl'};
                break;
        }
        okUtils.ajax({
            url:url,
            param: param
        }).done(function (data1) {
            if(!data1.data || data1.data.length === 0) {
                okUtils.ajax({
                    url: constantUrl.stMap.easySelect,
                    param: paramTmpl
                }).done(function (data1) {
                    loadData(data1.data)
                })
            }else {
                loadData(data1.data)
            }
        });
    }

    function loadData(data) {
        let domDepth = $('#divdepthList');
        let domHorizontal = $('#divhorizontalList');
        switch (type) {
            case 'depth':
                renderTableDepth(data);
                // table.reload('depthList',{data:data});
                domDepth.show();
                domHorizontal.hide();
                break;
            case 'horizontal':
                renderTableHorizontal(data);
                // table.reload('horizontalList',{data:data});
                domDepth.hide();
                domHorizontal.show();
                break;
            case 'vertical':
                renderTableHorizontal(data);
                // table.reload('horizontalList',{data:data});
                domDepth.hide();
                domHorizontal.show();
                break;
            default:
                domDepth.hide();
                domHorizontal.hide();
        }
    }

    function renderTableDepth(data) {
        table.render({
            elem: '#depthList'
            , page: false //是否显示分页
            , limit: data ? data.length : 0 //每页默认显示的数量
            , data : data
            , size:'sm'
            , height: 'full-40'
            , toolbar:'#toolbarV'
            , cols: [[ //标题栏
                {field: 'pipe', title: '管线'}
                , {field: 'code', title: '管线编码(大类)'}
                , {field: 'pressure', title: '压力类型'}
                , {field: 'pressure_code', title: '压力类型编码'}
                , {field: 'burying_method', title: '埋设方式'}
                , {field: 'burying_code', title: '埋设方式编码'}
                , {field: 'min_ST_SIZE', title: '最小管径'}
                , {field: 'max_ST_SIZE', title: '最大管径'}
                , {field: 'min_ST_PSVALUE', title: '最小压力'}
                , {field: 'max_ST_PSVALUE', title: '最大压力'}
                , {field: 'sidewalk', title: '人行道'}
                , {field: 'roadway', title: '马路'}
                , {field: 'ck', title: '分组'}
            ]]
        });
    }

    function renderTableHorizontal(data) {
        table.render({
            elem: '#horizontalList'
            , page: false //是否显示分页
            , limit: data ? data.length : 0 //每页默认显示的数量
            , data : data
            , size:'sm'
            , height: 'full-40'
            , toolbar:'#toolbarH'
            , cols: [[ //标题栏
                {field: 'pipe1', title: '管线1',width:90}
                , {field: 'code1', title: '管线1编码(大类)',width:140}
                , {field: 'pipe2', title: '管线2',width:90}
                , {field: 'code2', title: '管线2编码(大类)',width:140}
                , {field: 'pressure1', title: '压力类型1',width:90}
                , {field: 'pressure_code1', title: '压力类型编码1',width:90}
                , {field: 'pressure2', title: '压力类型2',width:90}
                , {field: 'pressure_code2', title: '压力类型编码2',width:90}
                , {field: 'burying_method1', title: '埋设方式1',width:90}
                , {field: 'burying_code1', title: '埋设方式编码1',width:90}
                , {field: 'burying_method2', title: '埋设方式2',width:90 }
                , {field: 'burying_code2', title: '埋设方式编码2',width:90 }
                , {field: 'min_ST_SIZE1', title: '最小管径1',width:90}
                , {field: 'max_ST_SIZE1', title: '最大管径1',width:90}
                , {field: 'min_ST_SIZE2', title: '最小管径2',width:90}
                , {field: 'max_ST_SIZE2', title: '最大管径2',width:90}
                , {field: 'min_ST_PSVALUE1', title: '最小压力1',width:90}
                , {field: 'max_ST_PSVALUE1', title: '最大压力1',width:90}
                , {field: 'min_ST_PSVALUE2', title: '最小压力2',width:90}
                , {field: 'max_ST_PSVALUE2', title: '最大压力2',width:90}
                , {field: 'iso', title: '标准值',width:90}
                , {field: 'ck', title: '分组',width:90}
            ]]
        });
    }
</script>
</body>
</html>

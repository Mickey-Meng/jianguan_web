<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>选择业务对象</title>
    <link rel="stylesheet" href="../../../../../lib/ok_admin/css/okadmin.css">
    <script type="text/javascript" src="../../../../../lib/ok_admin/lib/layui/layui.js"></script>
</head>
<body>
<div style="margin-left: 10px;margin-top: 10px">

    <div id="obDataBase" style="height: 400px;float: bottom">
        <table class="layui-hide" id="obData" lay-filter="obData"></table>
    </div>
</div>

<script type="text/html" id="toolbar">
    <form class="layui-form layui-col-md12" lay-filter="searchForm">
        <div class="layui-input-inline ok-search">
        <input class="layui-input" placeholder="表单名称" autocomplete="off" name="formName">
        </div>
        <div class="layui-input-inline ok-search">
        <input class="layui-input" placeholder="表单编号" autocomplete="off" name="formCode">
        </div>
        <button class="layui-btn" lay-submit="" lay-filter="search" >
        <i class="layui-icon">&#xe615;</i>
    </button>

    <button class="layui-btn" lay-submit="" lay-filter="submit" id="submit" style="margin-left: 20px">
        提交
        </button>
        <button class="layui-btn layui-btn-warm" lay-submit="" lay-filter="cancel" id="cancel">
        取消
        </button>
        </form>
</script>

<script>
    var $;

    layui.use(['tree', 'form', 'table', 'okUtils', "okLayer", 'constantUrl', 'xmSelect'], function () {
        $ = layui.jquery;
        var tree = layui.tree;
        var okUtils = layui.okUtils;
        var constantUrl = layui.constantUrl;
        var okLayer = layui.okLayer;
        var table = layui.table;
        var form = layui.form;

        form.on('search(searchForm)', function(data){
            let param = {};
            param.table = 'zlsk_oms_bo_def';
            param.mapStr = JSON.stringify({'name':data.field.formName,'code':data.field.formCode});
            table.reload({
                where: param,
                page: {curr: 1}
            })
        });

        table.render({
            elem: '#obData'
            , page: true
            , limit: 10
            , url: constantUrl.stForm.easySelect
            , headers:{token:okUtils.getCookie("token")}
            , where: {'table':'zlsk_oms_bo_def'}
            , parseData: function (res) {
                var result = {};
                if (this.page.curr) {
                    result = res.data.slice(this.limit * (this.page.curr - 1), this.limit * this.page.curr);
                } else {
                    result = res.data.slice(0, this.limit);
                }
                return {
                    "code": res.meow, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": result.length, //解析数据长度
                    "data": result //解析数据列表
                };
            }
            , toolbar:'#toolbar'
            , cols: [[ //标题栏
                {type:'radio'}
                , {field: 'name', title: '名称'}
                , {field: 'code', title: '编码'}
                , {field: 'ftbl', title: '是否生成表'}
            ]]
        });

        table.resize('obData');

        $("#submit").click(function () {
            var checkStatus = table.checkStatus('obData');
            if (!checkStatus.data || checkStatus.data.length === 0){
                layui.alert('请选择业务对象');
                return
            }
            parent.formFlag = checkStatus.data[0];
            parent.layer.close(parent.layer.getFrameIndex(window.name));
        });

        $("#cancel").click(function () {
            parent.layer.close(parent.layer.getFrameIndex(window.name));
        })

    })
</script>
</body>
</html>

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <script type="text/javascript" src="../../../lib/sfmbase/sfmUtil.js"></script>
    <script type="text/javascript">
    SFM.sfmUtil.loadEasyui();
    SFM.sfmUtil.loadSfmBase();
    </script>
    <script type="text/javascript">
    SFM.SfmTiledMenu = SFM.SfmMenuBase.extend({
        constructor: function(options) {
            var me = this;
            me.base(options);
            me.addAction('setMenuName', me._setMenuName);
        },
        destroy: function() {
            $('.sfm-m-mi-box-lv1').off('click');
            this.removeAction('setMenuName');
            this.base();
        },
        render: function() {
            var me = this;
            me.el = $('body');
            me._renderMenus();
            var m = me.menu && me.menu[0];
            if (m) {
                me.showMenu(m.mid);
            }
            me.base();
            return me;
        },


        showMenu: function(id) {
            $('.sfm-m-mi-box-lv1').removeClass('sfm-f-active');
            $('#' + id).addClass('sfm-f-active');
            $('.sfm-m-menu-panel').hide();
            var $mp = $('.sfm-m-menu-panel[data-panel=' + id + ']').show();
            this._setMi1Img();
            var w = 0;
            $mp.find('.sfm-m-mi-box-lv2').each(function() {
                w += $(this).width() + 6;
            });
            // var l = Number($('#divMenuBox').css('margin-left').replace('px', '')) + ($('#divMenuBox').width() - w) / 2;
            var am = this.getConfig().alignLv2;
            if (am == 'center') {
                var $mb = $('#divMenuBox');
                if ($mb.css('float') == 'right') {
                    l = $('body').width() - Number($mb.css('margin-right').replace('px', '')) - $mb.width() / 2 - w / 2;
                } else {
                    l = Number($('#divMenuBox').css('margin-left').replace('px', '')) + ($('#divMenuBox').width() - w) / 2;
                }
                $mp.css('left', l + 'px');
            } else {
                $mp.css('right', (this.getConfig().marginRight || 0) + 'px');
            }
        },

        _bindEvents: function() {
            var me = this;
            $('.sfm-m-mi-box-lv1').on('click', function() {
                me.showMenu(this.id);
            });
            $('.sfm-m-mi-box-lv1').on('mouseover', function() {
                var $t = $(this);
                if (!$t.hasClass('sfm-f-hover')) {
                    $t.addClass('sfm-f-hover');
                }
                me._setMi1Img();
            });
            $('.sfm-m-mi-box-lv1').on('mouseout', function() {
                var $t = $(this);
                if ($t.hasClass('sfm-f-hover')) {
                    $t.removeClass('sfm-f-hover');
                }
                me._setMi1Img();
            });
            me.base();
            return me;
        },

        _renderMenus: function() {
            var me = this;
            var menus = me.menu;
            var h1 = '';
            var h2 = '';
            if (menus) {
                var h1 = '<div class="sfm-m-menu-lv1-box ">';
                var h2 = '';
                for (var i = 0; i < menus.length; i++) {
                    var mi = menus[i];
                    h1 += me._getMi1Html(mi);
                    h2 += '<div class="sfm-m-menu-panel" data-panel="' + mi.mid + '">';
                    if (mi.children) {
                        for (var j = 0; j < mi.children.length; j++) {
                            var cmj = mi.children[j];
                            h2 += me._getMi2Html(cmj);
                        }
                    }
                    h2 += '</div>';
                }
                h1 += '</div>';
            }
            $('#divMenuBox').html(h1);
            $('#divMenuBox2').html(h2);
        },
        _setMi1Img: function() {
            var me = this;
            $('.sfm-m-mi-box-lv1').each(function() {
                var $t = $(this);
                var mi = me._getMi1(this.id);
                if (mi && mi.icon1) {
                    var $i = $t.find('img');
                    if ($t.hasClass('sfm-f-active') || $t.hasClass('sfm-f-hover')) {
                        $i[0].src = mi.icon1;
                    } else {
                        $i[0].src = mi.icon;
                    }
                }
            });
        },
        _getMi1: function(id) {
            var menus = this.menu;
            if (menus) {
                for (var i = 0; i < menus.length; i++) {
                    if (menus[i].mid == id) {
                        return menus[i];
                    }
                }
            }
            return null;
        },
        _getMi1Html: function(mi) {
            var h = '';
            if (mi) {
                h += '<div id="' + mi.mid + '" class="sfm-m-mi-box sfm-m-mi-box-lv1">';
                if (mi.icon != null) {
                    h += '<img src="' + mi.icon + '" class="sfm-m-mi-img" />';
                }
                h += '<div class="sfm-m-mi-text">' + mi.name + '</div>';
                h += '</div>';
            }
            return h;
        },
        _getMi2Html: function(mi) {
            var h = '';
            if (mi) {
                var s = mi.disabled ? ' disabled="disabled"' : '';
                var acn = mi.actived ? ' sfm-f-active' : '';
                h += '<div id="' + mi.mid + '" class="sfm-m-mi-box sfm-m-mi-box-lv2' + acn + '" data-mk="' + (mi.mk || mi.id) + '"';
                if (mi.radioGroup) {
                    h += ' data-rg="' + mi.radioGroup + '"';
                }
                h += s + '>';
                if (mi.icon != null) {
                    h += '<img src="' + mi.icon + '" class="sfm-m-mi-img" />';
                }
                h += '<div id="' + mi.mid + '_t" class="sfm-m-mi-text">' + mi.name + '</div>';
                h += '</div>';
            }
            return h;
        },
        _setMenuName: function(mk, name) {
            var me = this;
            if (mk) {
                var mi = me.menuMap[mk];
                if (mi) {
                    var $md = me.el.find('#' + mi.mid);
                    me._setMiName($md, name);
                }
            }
            me.doAction('onSetMenuName', null, mk, name);
            return me;
        },
        _setMiName: function($mi, name) {
            $mi.find('.sfm-m-mi-text').text(name);
            return this;
        },

        __className__: 'SfmTiledMenu'
    });

    var tiledMenu = new SFM.SfmTiledMenu({ ctx: window });
    </script>
    <script type="text/javascript">
    tiledMenu.initConfig();
    $(function() {
        tiledMenu.render();
    });
    </script>
</head>

<body>
    <div id="divMenuBox" class="sfm-m-menu-box"></div>
    <div id="divMenuBox2" class="sfm-m-menu-lv2-box"></div>

</body>

</html>

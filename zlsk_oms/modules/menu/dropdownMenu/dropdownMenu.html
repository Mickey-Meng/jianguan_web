<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <script type="text/javascript" src="../../../lib/sfmbase/sfmUtil.js"></script>
    <script type="text/javascript">
        SFM.sfmUtil.loadJquery();
        SFM.sfmUtil.loadSfmBase();
    </script>
    <script type="text/javascript">
    SFM.SfmDropdownMenu = SFM.SfmMenuBase.extend({
        constructor: function(options){
            var me = this;
            me.base(options);
            me.addAction('setMenuName', me._setMenuName);
        },
        destroy: function(){
            $('.sfm-m-mi-box-lv1').off('click');
            this.base();
        },
        render: function(){
            var me = this;
            me.el = $('body');
            me._renderMenus();
            var m = me.menu && me.menu[0];
            if(m){
                me.showMenu(m.mid);
            }
            me.base();
            return me;
        },


        showMenu: function(id){
            $('.sfm-m-mi-box-lv1').removeClass('sfm-f-active');
            $('#' + id).addClass('sfm-f-active');
            $('.sfm-m-menu-panel').hide();
            var $mp = $('.sfm-m-menu-panel[data-panel=' + id + ']').show();
            this._setMi1Img();
        },

        _bindEvents: function(){
            var me = this;
            $('.sfm-m-mi-box-lv1').on('click', function(){
                me.showMenu(this.id);
            });
            $('.sfm-m-mi-box-lv1').on('mouseover', function(){
                var $t = $(this);
                if(!$t.hasClass('sfm-f-hover')){
                    $t.addClass('sfm-f-hover');
                }
                me._setMi1Img();
            });
            $('.sfm-m-mi-box-lv1').on('mouseout', function(){
                var $t = $(this);
                if($t.hasClass('sfm-f-hover')){
                    $t.removeClass('sfm-f-hover');
                }
                me._setMi1Img();
            });
            me.base();
            return me;
        },

        _renderMenus: function(){
            var me = this;
            var menus = me.menu;
            var h1 = '';
            if(menus){
                var h2 = '';
                for(var i = 0;i < menus.length;i++){
                    var mi = menus[i];
                    h1 += me._getMi1Html(mi);
                }
            }
            $('#divMenuBox').html(h1);
        },
        _setMi1Img: function(){
            var me = this;
            $('.sfm-m-mi-box-lv1').each(function(){
                var $t = $(this);
                var mi = me._getMi1(this.id);
                if(mi && mi.icon1){
                    var $i = $t.find('img');
                    if($t.hasClass('sfm-f-active') || $t.hasClass('sfm-f-hover')){
                        $i[0].src = mi.icon1;
                    }else{
                        $i[0].src = mi.icon;
                    }
                }
            });
        },
        _getMi1: function(id){
            var menus = this.menu;
            if(menus){
                for(var i = 0;i < menus.length;i++){
                    if(menus[i].mid == id){
                        return menus[i];
                    }
                }
            }
            return null;
        },
        _getMi1Html: function(mi){
            var h = '';
            if(mi){
                h += '<div id="' + mi.mid + '" class="sfm-m-mi-box sfm-m-mi-box-lv1">';
                if(mi.icon != null){
                    h += '<img src="' + mi.icon + '" class="sfm-m-mi-img" />';
                }
                h += '<div class="sfm-m-mi-text">' + mi.name + '</div>';
                if(mi.children){
                    h += '<div class="sfm-m-menu-panel" data-panel="' + mi.mid + '">';
                    for(var j = 0;j < mi.children.length;j++){
                        var cmj = mi.children[j];
                        h += this._getMi2Html(cmj);
                    }
                    h += '</div>';
                }
                h += '</div>';
            }
            return h;
        },
        _getMi2Html: function(mi){
            var h = '';
            if(mi){
                var s = mi.disabled ? ' disabled="disabled"' : '';
                var acn = mi.actived ? ' sfm-f-active' : '';
                h += '<div id="' + mi.mid + '" class="sfm-m-mi-box sfm-m-mi-box-lv2' + acn + '" data-mk="' + (mi.mk || mi.id) + '"';
                if(mi.radioGroup){
                    h += ' data-rg="' + mi.radioGroup + '"';
                }
                h += s + '>';
                if(mi.icon != null){
                    h += '<img src="' + mi.icon + '" class="sfm-m-mi-img" />';
                }
                h += '<div id="' + mi.mid + '_t" class="sfm-m-mi-text">' + mi.name + '</div>';
                h += '</div>';
            }
            return h;
        },
        _setMenuName: function(mk, name){
            var me = this;
            if(mk){
                var mi = me.menuMap[mk];
                if(mi){
                    var $md = me.el.find('#' + mi.mid);
                    me._setMiName($md, name);
                }
            }
            me.doAction('onSetMenuName', null, mk, name);
            return me;
        },
        _setMiName: function($mi, name){
            $mi.find('.sfm-m-mi-text').text(name);
            return this;
        },

        __className__: 'SfmDropdownMenu'
    });

    var dropdownMenu = new SFM.SfmDropdownMenu({ctx: window});
    </script>
    <script type="text/javascript">
        dropdownMenu.initConfig();
        $(function(){
            dropdownMenu.render();
        });
    </script>
</head>

<body>
    <div id="divMenuBox" class="sfm-m-menu-box sfm-m-menu-box-lv1"></div>
</body>
</html>

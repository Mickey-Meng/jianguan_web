!function(e,i){if("undefined"!=typeof module&&module.exports){var n=require("jquery"),t=require("underscore"),r=require("SfmModuleBase");module.exports=e(n,t,r)}else"function"==typeof define&&define.amd?define(["jquery","underscore","sfmModuleBase"],e):(null==i.SFM&&(i.SFM={}),i.SFM.SfmMenuBase=e(i.$,i._,i.SFM.SfmModuleBase))}(function(_,e,i){var l="SFM_ALL";return i.extend({constructor:function(e){var i=this;i.base(e),i.addAction("isMenuVisible",i._isMenuVisible),i.addAction("setMenuVisible",i._setMenuVisible),i.addAction("isMenuAvailable",i._isMenuAvailable),i.addAction("setMenuAvailable",i._setMenuAvailable),i.addAction("isMenuActive",i._isMenuActive),i.addAction("setMenuActive",i._setMenuActive),i.addAction("clickMenu",i._clickMenu)},destroy:function(){this.removeAction("setMenuVisible"),this.removeAction("setMenuAvailable"),this.removeAction("setMenuActive"),this.removeAction("clickMenu"),this.base()},initConfig:function(){return this.base(),this._initMenu(),this},render:function(){this._bindEvents(),this.resize(),this.base()},resize:function(){return this},__getMiBox__:function(e){return _(".sfm-f-mi-box")},__getMenuBox__:function(e){return this.el.find("#"+e.mid)},__canExec__:function(e,i){return!i[0].disabled},_initMenu:function(){var e=this,i=(0,e.getSfmUtil().valueOrDefault)(e.config,"menuInfo",null);if(i){var n=e.menu=_.extend(!0,[],i);e.menuMap={};return e.menuIds={},e._setId(n,0),e}},_bindEvents:function(){var e=this;return e.el&&e._bindMenuEvents(e.menu),e},_bindMenuEvents:function(e){for(var a=this,l=a.menuMap,i=0;i<e.length;i++){var n=e[i];if(n.url){l[n.mk||n.id]=n;var t=a.__getMenuBox__(n);n.actived&&t.addClass("sfm-f-active"),t.on("click",function(s,o){return function(){if(a.__canExec__(s,o)){function e(e){s.module=e}var i=s.param||null,n=o.hasClass("sfm-f-active");if(-1<(" "+s.menuType+" ").indexOf(" radio ")){var t=s.radioGroup;a.el.find('[data-rg="'+t+'"]').each(function(){var e=_(this);if(e.hasClass("sfm-f-active")&&this.id!=s.mid){e.removeClass("sfm-f-active");var i=e.attr("data-mk"),n=i&&l[i];n&&n.module&&a.getSfmModuleMgr().destroyModule({mid:n.module.getId()},"none"!=n.type)}}),o.addClass("sfm-f-active")}if(-1<(" "+s.menuType+" ").indexOf(" toggle ")){var r=o;n?(r.removeClass("sfm-f-active"),s.module&&a.getSfmModuleMgr().destroyModule({mid:s.module.getId()},"none"!=s.type)):(r.addClass("sfm-f-active"),delete(u=_.extend(!0,{},s)).mid,s.module?s.module.data&&_.extend(u,{mid:s.module.getId()}):delete s.module,a.getSfmModuleMgr().loadModule(u,i,e))}else{var u;delete(u=_.extend(!0,{},s)).mid,s.module?s.module.data&&_.extend(u,{mid:s.module.getId()}):delete s.module,a.getSfmModuleMgr().loadModule(u,i,e)}}}}(n,t))}n.children&&a._bindMenuEvents(n.children)}return a},_bindHoverEvents:function(e){var i=this,n=i.__getMiBox__(e);return n.on("mouseover",function(){var e=_(this);e.hasClass("sfm-f-hover")||e.addClass("sfm-f-hover"),i._setMiImg(this.id)}),n.on("mouseout",function(){var e=_(this);e.hasClass("sfm-f-hover")&&e.removeClass("sfm-f-hover"),i._setMiImg(this.id)}),i},_setId:function(e,i){for(var n=this,t=0;t<e.length;t++){var r=e[t];r.mid=n.__className__+"_m"+i+"_"+n.getSfmUtil().fguid()+"_"+(new Date).getTime(),(n.menuIds[r.mid]=r).groups=r.group&&r.group.split(",")||[],r.url&&(r.url.lastIndexOf(".js"),r.url.length),r.children&&n._setId(r.children,i+1)}return n},_setMiImg:function(e){var t=this;t.__getMiBox__(e).each(function(){var e=_(this),i=t._getMi(this.id);if(i&&i.icon1){var n=e.find("img");0<n.length&&(e.hasClass("sfm-f-active")||e.hasClass("sfm-f-hover")?n[0].src=i.icon1:n[0].src=i.icon)}})},_getMi:function(e){return this.menuIds[e]||null},_isMenuVisible:function(e,i){var n=this;if(e&&(r=n.menuMap[e]))return n._isMiVisible(n.__getMenuBox__(r));if(i)for(var t=0;t<n.menu.length;t++){var r=n.menu[t];if(i==l||-1<n._inGroup(i,r.groups))return n._isMiVisible(n.__getMenuBox__(r));if(r.children)for(var u=0;u<r.children.length;u++){var s=r.children[u];if(i==l||-1<n._inGroup(i,s.groups))return n._isMiVisible(n.__getMenuBox__(r))}}return!1},_setMenuVisible:function(e,i,n){var t=this,r=t.menuMap[e];r=n?"show":"hide";e&&(s=t.menuMap[e])&&t._setMiVisible(t.__getMenuBox__(s),n,r);if(i)for(var u=0;u<t.menu.length;u++){var s=t.menu[u];if((i==l||-1<t._inGroup(i,s.groups))&&t._setMiVisible(t.__getMenuBox__(s),n,r),s.children)for(var o=0;o<s.children.length;o++){var a=s.children[o];(i==l||-1<t._inGroup(i,a.groups))&&t._setMiVisible(t.__getMenuBox__(s),n,r)}}return t.doAction("onSetMenuVisible",null,e,i,n),t},_isMenuAvailable:function(e,i){var n=this;if(e&&(u=n.menuMap[e])){var t=n.__getMenuBox__(u);return n._isMiAvailable(t)}if(i)for(var r=0;r<n.menu.length;r++){var u=n.menu[r];if(i==l||-1<n._inGroup(i,u.groups)){t=n.__getMenuBox__(u);return n._isMiAvailable(t)}if(u.children)for(var s=0;s<u.children.length;s++){var o=u.children[s];if(i==l||-1<n._inGroup(i,o.groups)){t=n.el.find("#"+o.mid);return n._isMiAvailable(t)}}}return!1},_setMenuAvailable:function(e,i,n){var t=this;if(e&&(s=t.menuMap[e])){var r=t.__getMenuBox__(s);t._setMiAvailable(r,n)}if(i)for(var u=0;u<t.menu.length;u++){var s=t.menu[u];if(i==l||-1<t._inGroup(i,s.groups)){r=t.__getMenuBox__(s);t._setMiAvailable(r,n)}if(s.children)for(var o=0;o<s.children.length;o++){var a=s.children[o];if(i==l||-1<t._inGroup(i,a.groups)){r=t.el.find("#"+a.mid);t._setMiAvailable(r,n)}}}return t.doAction("onSetMenuAvailable",null,e,i,n),t},_isMenuActive:function(e,i){var n=this;if(e&&(r=n.menuMap[e]))return n._isMiActive(n.__getMenuBox__(r));if(i)for(var t=0;t<n.menu.length;t++){var r=n.menu[t];if(i==l||-1<n._inGroup(i,r.groups))return n._isMiActive(n.__getMenuBox__(r));if(r.children)for(var u=0;u<r.children.length;u++){var s=r.children[u];if(i==l||-1<n._inGroup(i,s.groups))return n._isMiActive(n.__getMenuBox__(r))}}return!1},_setMenuActive:function(e,i,n){var t=this,r=n?"addClass":"removeClass";e&&(s=t.menuMap[e])&&t._setMiActive(t.__getMenuBox__(s),n,r);if(i)for(var u=0;u<t.menu.length;u++){var s=t.menu[u];if((i==l||-1<t._inGroup(i,s.groups))&&t._setMiActive(t.__getMenuBox__(s),n,r),s.children)for(var o=0;o<s.children.length;o++){var a=s.children[o];(i==l||-1<t._inGroup(i,a.groups))&&t._setMiActive(t.__getMenuBox__(s),n,r)}}return t.doAction("onSetMenuActive",null,e,i,n),t},_isMiVisible:function(e){return e.is(":visible")},_isMiAvailable:function(e){return!(!e||!e[0])&&!e[0].disabled},_isMiActive:function(e){return e.hasClass("sfm-f-active")},_setMiVisible:function(e,i,n){return e[n](),this},_setMiAvailable:function(e,i){return i?e.removeAttr("disabled"):e.attr("disabled","disabled"),e[0]&&(e[0].disabled=!i),this},_setMiActive:function(e,i,n){return e[n]("sfm-f-active"),this},_clickMenu:function(e){if(e){var i=this.menuMap[e];i&&this.__getMenuBox__(i).click()}return this},_inGroup:function(e,i){return _.inArray(e,i)},__className__:"SfmMenuBase"})},window);

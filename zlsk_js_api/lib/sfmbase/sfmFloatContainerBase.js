!function(t,e){if("undefined"!=typeof module&&module.exports){var n=require("jquery"),i=require("underscore"),l=require("SfmContainerBase");module.exports=t(n,i,l)}else"function"==typeof define&&define.amd?define(["jquery","underscore","sfmContainerBase"],t):(null==e.SFM&&(e.SFM={}),e.SFM.SfmFloatContainerBase=t(e.$,e._,e.SFM.SfmContainerBase))}(function(J,t,e){var x=300,S=400,K=document,L={},T=function(t,e,n,i){var l=t,o=e,a=n,r=i,f={};return null==l&&null==o&&null==n?(l=10,a=x,f.left=l,f.width=a):null!=l?(f.left=l,f.width=null!=a?a:null==o?x:i-l-o):null!=a?(f.width=a,f.left=null==o?10:r-o-a):(f.width=x,f.left=r-f.width-o),f},D=function(t,e,n,i){var l=t,o=e,a=n,r=i,f={};return null==l&&null==o&&null==a?(f.top=10,f.height=S):null!=l?(f.top=l,f.height=null!=a?a:null==o?S:r-l-o):null!=a?(f.height=a,f.top=null==o?10:r-a-o):(f.height=S,f.top=r-f.height-o),f};return e.extend({constructor:function(t){this.base(t),this._floatTypes=[],this._panelPos={}},destroy:function(){this.base()},resize:function(){var t=this,e=t.__getFloatTypes__();if(!e||0==e.length)return t;for(var n=0;n<e.length;n++){var i=t.__getFloatCd__(e[n]);if(i&&0!=i.length){var l=t.__getFloatContainerByType__(e[n]);if(l&&0!=l.length)for(var o=0;o<i.length;o++){var a=i[o].positionInfo,r=i[o].type,f=i[o].id;a.pwidth=l.width(),a.pheight=l.height();var h=t._calcPos(a,r,f);i[o].panelPostion=h,i[o].panel.width(h.width).height(h.height).css({left:h.left+"px",top:h.top+"px"})}}}return t},showContainer:function(t,e){return this.base(t,e),this},openContainer:function(t){var e=this,n=e.getSfmUtil().valueOrDefault,i=n(t,"type",null),l=n(t,"region",null),o=e._containerDesc;return i&&l&&o&&e.__getFloatCd__(i)&&("float"==l?e._openFloat(t):e.base(t)),e},closeContainer:function(t){var e=this.getSfmUtil().valueOrDefault,n=e(t,"cd",null);if(!n){var i=e(t,"id",null);if(!i)return;n=this.__findContainerByCid__(i)}if(n){if("float"==n.region)return void this._closeFloat({id:i,cd:n});this.base(t)}},__getFloatTypes__:function(){return this._floatTypes},__checkFloatTypes__:function(t){return t&&0<=J.inArray(t,this._floatTypes)},__getFloatCd__:function(t){return this._containerDesc[t]},__getFloatContainerByType__:function(t){},_calcPos:function(t,e,n){var i=this;if(!t)return function(t,e,n,i,l,o,a,r){var f=T(t,n,l,a),h=D(e,i,o,r);return J.extend({left:10,top:10,width:x,height:S},f,h)}();var l=i.getSfmUtil().valueOrDefault,o=0,a=0;if(null!=t.left&&o++,null!=t.width&&o++,null!=t.right&&o++,null!=t.top&&a++,null!=t.height&&a++,null!=t.bottom&&a++,1<o&&1<a){var r=null,f=null;r="center"==t.halign?function(t,e){var n=null==t?x:t;return{left:(e-n)/2,width:n}}(t.width,t.pwidth):T(t.left,t.right,t.width,t.pwidth),f="middle"==t.valign?function(t,e){var n=null==t?S:t;return{top:(e-n)/2,height:n}}(t.height,t.pheight):D(t.top,t.bottom,t.height,t.pheight);var h={left:10,top:10,width:x,height:S};return(h=J.extend(h,r,f)).left<0&&(h.left=0),h.top<0&&(h.top=0),h.width<=0&&(h.width=x),h.height<=0&&(h.height=S),h}for(var u=null!=t.width?t.width:x,s=null!=t.height?t.height:S,c=null==t.right,d=c?"leftStart":"rightStart",g=l(i.config,"topStart",10),p=l(i.config,d,10),_=l(i.config,"stepY",40),v=l(i.config,"stepX",40),m=(h={width:u,height:s,pwidth:t.pwidth,pheight:t.pheight},null),w=null,y=c?"left":"right",b=i._panelPos[e]||(i._panelPos[e]=[]),F=b.length-1;0<=F;F--)if(null!=b[F][y]){m=b[F][y],w=b[F].top;break}null==m||null==w?(h.top=g,h[y]=p):(h.top=w+_,h[y]=m+v);var C={id:n,top:h.top};return C[y]=h[y],b.push(C),i._calcPos(h)},_showFloat:function(t){return this},_openFloat:function(t){var n=this,i=n.getSfmUtil().valueOrDefault,e=i(t,"type",null);if(!n.__checkFloatTypes__(e))return n;var l=n.__getFloatCd__(e);if(!l)return n;var a=n.__getFloatContainerByType__(e);if(!a||0==a.length)return n;var o=i(t,"floatType","panel"),r=i(t,"width",null),f=i(t,"height",null),h=i(t,"left",null),u=i(t,"right",null),s=i(t,"top",null),c=i(t,"bottom",null),d=i(t,"halign",null),g=i(t,"valign",null),p=i(t,"title",""),_=i(t,"draggable",!0),v=i(t,"dragArea","title"),m=i(t,"enableClose",!0),w=i(t,"enableMax",!1),y=i(t,"enableMin",!1),b=i(t,"closable",!0),F=i(t,"clean",!1),C=i(t,"cleanExclude",!1),x=i(t,"zIndex",1010),S=i(t,"background",!0),T=i(t,"bgBorder",5),D=i(t,"shadow",!1);if(F)for(var k=0;k<l.length;k++)l[k].closable&&!l[k].cleanExclude&&(n._closeFloat({id:l[k].cid}),k--);var B=!1,P=n.__className__+"_"+n.getSfmUtil().fguid()+(new Date).getTime(),I=P+"_c",O='<div id="'+P+'" class="sfm-f-float-container'+(D?" sfm-f-float-container-shadow":"")+'" style="position:absolute;">';O+='<div id="inner_'+P+'" class="sfm-f-float-container-inner">',"window"==o&&(B=!0,O+='<div id="title_'+P+'" class="sfm-f-float-window-title">',O+="<span>"+p+"</span>",y&&(O+='<div id="minbtn_'+P+'" class="sfm-f-float-window-min-btn"></div>'),w&&(O+='<div id="maxbtn_'+P+'" class="sfm-f-float-window-max-btn"></div>'),m&&(O+='<div id="cloasebtn_'+P+'" class="sfm-f-float-window-close-btn"><i class="fa fa-close fa-lg"></i></div>'),O+="</div>"),O+='<div id="'+I+'" class="sfm-f-float-panel-widget-container sfm-f-viewContainer"></div>',O+="</div>";var M=J(O+="</div>"),U=M.find("#inner_"+P),q=M.find("#title_"+P),z=M.find("#"+I);S||(M[0].style.background="transparent",M[0].style.filter="",U[0].style.background="transparent",B&&(q[0].style.background="transparent"),z[0].style.background="transparent"),T&&(M[0].style.padding=T+"px");var X={width:r,height:f,left:h,right:u,top:s,bottom:c,halign:d,valign:g,pwidth:a.width(),pheight:a.height()},Y=n._calcPos(X,e,P),$=Y.width,E=Y.height,H={type:e,region:"float",state:1,id:P,container:z,cid:I,floatType:o,closable:b,cleanExclude:C,positionInfo:X,panelPostion:Y,panel:M,funcs:{setSize:function(t){if(t&&(null!=t.width&&M.width(t.width),null!=t.height)){z.height(t.height);var e=B?i(n.config,"titleHeight",34):0;M.height(t.height+e)}},getCfgSize:function(){return{width:$,height:E}}}};M.width(Y.width).height(Y.height).css({left:Y.left+"px",top:Y.top+"px","z-index":x});var j=n.__getCtnrInfo__(H),A=i(t,"onOpen",null);if("function"==typeof A&&A(j),a.append(M),B){var N=i(n.config,"titleHeight",34);z.height(M.height()-N)}if(_){var W=q;"panel"==v&&(W=M),H.$da=W,H.cbonmd=function(t){L[P]={startDrag:!0,x:t.screenX,y:t.screenY}},H.cbonmu=function(t){L[P]&&delete L[P].startDrag},H.cbonmm=function(t){var e=L[P];if(e&&!0===e.startDrag){var n=Y.left+t.screenX-e.x,i=Y.top+t.screenY-e.y;e.x=t.screenX,e.y=t.screenY;var l=n+M.outerWidth()-a.width();0<l&&(n-=l);var o=i+M.outerHeight()-a.height();0<o&&(i-=o),n<0&&(n=0),i<0&&(i=0),Y.left=n,Y.top=i,M.css("left",n+"px"),M.css("top",i+"px"),t.preventDefault()}},W.on("mousedown",H.cbonmd),J(K).on("mouseup",H.cbonmu).on("mousemove",H.cbonmm)}"window"==o&&M.find("#cloasebtn_"+P).on("click",function(){n._closeFloat({id:I})});var Z=i(t,"onOpened",null);for(var G in"function"==typeof Z&&Z(j),t)"function"==typeof t[G]&&(H[G]=t[G]);return l.push(H),n},_closeFloat:function(t){var e=this,n=(0,e.getSfmUtil().valueOrDefault)(t,"id",null);if(!n)return e;var i=e._containerDesc,l=e.__getFloatTypes__();if(!i||!l||0==l.length)return e;for(var o=null,a=0;a<l.length;a++){var r=e.__getFloatCd__(l[a]);if(r)for(var f=0;f<r.length;f++)if(r[f].cid==n){var h=(o=r[f]).onClose;if("function"==typeof h)if(!h(e.__getCtnrInfo__(o)))return;o=r.splice(f,1)[0],f--;break}}if(o){var u=e.__getCtnrInfo__(o);o.container&&o.container.unbind().remove(),o.panel&&o.panel.unbind().remove(),"function"==typeof o.cbonmd&&o.$da&&o.$da.off(),"function"==typeof o.cbonmu&&J(K).off("mouseup",o.cbonmu),"function"==typeof o.cbonmm&&J(K).off("mousemove",o.cbonmm);var s=o.onClosed;"function"==typeof s&&s(u);var c=e._panelPos[o.type];if(c)for(a=0;a<c.length;a++)c[a].id==o.id&&(c.splice(a,1),a--)}return e},_setZIndex:function(t,e){if(!this.__checkFloatTypes__(e))return this;this._containerDesc[e];return this},__className__:"SfmFloatContainerBase"})},window);

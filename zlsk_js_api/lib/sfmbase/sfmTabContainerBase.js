!function(t,e){if("undefined"!=typeof module&&module.exports){var n=require("jquery"),a=require("underscore");require("sfmFloatContainerBase");module.exports=t(n,a,SfmContainerBase)}else"function"==typeof define&&define.amd?define(["jquery","underscore","sfmFloatContainerBase"],t):(null==e.SFM&&(e.SFM={}),e.SFM.SfmTabContainerBase=t(e.$,e._,e.SFM.SfmFloatContainerBase))}(function(F,t,e){return e.extend({constructor:function(t){this.base(t),this.data._tabNum=0},destroy:function(){this.base()},__getTabContainerDesc__:function(t){},__getTabContainer__:function(t){},__getTabPaneContainer__:function(t){},__getTabMaxNum__:function(t){return 10},__getTabNum__:function(t){return this.data._tabNum},__changeTabNum__:function(t,e){this.data._tabNum+=e},__checkClose__:function(t){return!1!==t.tab},_showTab:function(t){var l=this,e=l.getSfmUtil().valueOrDefault,d=e(t,"id",null);if(!d)return!1;var n=e(t,"type",null),a=e(t,"region",null),c=l.__findContainerByCid__(d,n,a);if(!c)return!1;a=c.region;var i=l.__getTabContainer__(t),f=l.__getTabPaneContainer__(t);return!(!i||0==i.length||!f||0==f.length)&&(n=c.type,i.find(".sfm-f-nav-tabs li").each(function(t,e){var n=F(this).find("a");n.attr("id")==d+"_a"?n.addClass("sfm-f-active"):n.removeClass("sfm-f-active")}),f.find(".sfm-f-tab-pane").each(function(t,e){var n=c.onShow,a=c.onShown,i=(c.onHide,c.onHidden,F(this)),f=l.__getCtnrInfo__(c);if(this.id==d+"_p")"function"==typeof n&&n(f),i.show(),"function"==typeof a&&a(f);else if(i.attr("data-sfm-region")==c.region){var _=l.__findContainerByCid__(this.id.substr(0,this.id.length-2));if(!_)return!1;var r=l.__getCtnrInfo__(_),o=_.onHide;"function"==typeof o&&o(f),i.hide();var s=_.onHidden;"function"==typeof s&&s(r)}}),!0)},_openTab:function(t){var e=this,n=e.getSfmUtil().valueOrDefault,a=n(t,"region",null);if(!a)return!1;var i=e.__getTabContainerDesc__(t);if(!i)return!1;var f=e.__getTabContainer__(t),_=e.__getTabPaneContainer__(t);if(!f||0==f.length||!_||0==_.length)return!1;var r=n(t,"closable",!0),o=n(t,"active",!0),s=n(t,"tab",!0),l=n(t,"tabKey",null),d="tab_"+e.getSfmUtil().fguid()+"_"+(new Date).getTime(),c=n(t,"title",n(t,"name",""));if(s){var u=e.__getTabMaxNum__(t);if(null==u&&(u=10),e.__getTabNum__(t)>=u)for(var m=i.length-1;0<=m;m--)if(e.__checkClose__(t,i[m])){if(!(e.__getTabNum__(t)>=u))break;e._closeTab({id:i[m].cid})}var b=f.find(".sfm-f-nav-tabs");if(0==b.length){f.html('<ul class="sfm-f-nav-tabs"></ul>'),b=f.find(".sfm-f-nav-tabs")}var g='<li id="'+d+'_l" data-sfm-region="'+a+'">';g+='<a id="'+d+'_a" class="sfm-t-tab">',g+='<span class="sfm-f-tab-title">'+c+"</span>",r&&(g+='<span id="'+d+'_c" class="sfm-f-tab-close sfm-t-closebtn">&times;</span>'),g+="</a></li>",b.append(g),F("#"+d+"_c").on("click",function(t){e._closeTab({id:d})}),F("#"+d+"_l").on("click",function(){e._showTab({id:d})})}var v='<div id="'+d+'_p" data-sfm-region="'+a+'" class="sfm-f-tab-pane" style="display:none;"></div>',h='<div id="'+d+'" class="sfm-f-tab-container"'+(l?' data-tk="'+l+'"':"")+"></div>";_.append(v);var p=n(t,"ctype",null);"dialog"==p&&(h='<div id="'+d+'_dt" class="sfm-f-tab-dialog-title sfm-t-tab-dialog-title"><div class="sfm-f-tab-dialog-title-text sfm-t-tab-dialog-title-text">'+c+'</div><div id="'+d+'_dc" class="sfm-f-tab-close sfm-t-closebtn">&times;</div></div>'+h);var C=_.find("#"+d+"_p");C.html(h),"dialog"==p?F("#"+d+"_dc").on("click",function(t){e._closeTab({id:d})}):C.css("padding","0px");var T='<iframe id="'+d+'_frm"';T+=' name="'+d+'_frm"',T+=' allowtransparency="true"',T+=' frameborder="0" style="width: 100%;height: 100%;"></iframe>';var y=C.find("#"+d);y.html(T),e.__changeTabNum__(t,1),e.resize();var w=C.width(),S=C.height(),N=n(t,"onOpen",null),k={type:t.type,region:a,state:1,tab:s,id:d+"_p",container:y,cid:d,ctype:t.ctype,width:w,height:S};for(var x in t)"function"==typeof t[x]&&(k[x]=t[x]);i.push(k);var B=e.__getCtnrInfo__(k);"function"==typeof N&&N(B),o&&e._showTab({id:d});var D=n(t,"onOpened",null);return"function"==typeof D&&D(B),!0},_closeTab:function(t){var e=this,n=(0,e.getSfmUtil().valueOrDefault)(t,"id",null);if(!n)return!1;var a=e.__getTabContainerDesc__(t);if(!a)return!1;var i=e.__getTabContainer__(t),f=e.__getTabPaneContainer__(t);if(!i||0==i.length||!f||0==f.length)return!1;for(var _=0,r=null,o=0;o<a.length;o++)if(e.__checkClose__(t,a[o])){var s=!1===a[o].tab?0:1;if(_+=s,a[o].cid==n){var l=a[o].onClose;"function"==typeof l&&l(e.__getCtnrInfo__(a[o])),r=a.splice(o,1),_-=s,o--}}for(o=a.length-1;0<=o;o--)if(a[o].region==r[0].region){e._showTab({id:a[o].cid});break}if(f.find("#"+n+"_p").remove(),e.__changeTabNum__(r[0],-1),!1!==r[0].tab){var d=i.find(".sfm-f-nav-tabs"),c=d.find("#"+n+"_a"),u=d.find("#"+n+"_l"),m=u.find("#"+n+"_c");0<m.length&&m.remove(),c.remove(),u.remove()}var b=r&&r[0]&&r[0].onClosed;if("function"==typeof b&&b(e.__getCtnrInfo__(r[0])),0==i.find(".sfm-f-nav-tabs li .sfm-f-active").length)if(0<_){var g=i.find(".sfm-f-nav-tabs li")[_-1].id;g=g.substr(0,g.length-2),e._showTab({id:g})}else i.empty();return!0},__className__:"SfmTabContainerBase"})},window);

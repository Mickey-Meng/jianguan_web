!function(t,e){if("undefined"!=typeof module&&module.exports){var i=require("jquery"),n=require("underscore"),r=require("base"),o=require("sfmEvent"),s=require("sfmUtil");module.exports=t(i,n,r,o,s)}else"function"==typeof define&&define.amd?define(["jquery","underscore","base","sfmEvent","sfmUtil"],t):(null==e.SFM&&(e.SFM={}),e.SFM.SfmModuleBase=t(e.$,e._,e.SFM.Base,e.SFM.sfmEvent,e.SFM.sfmUtil))}(function(o,t,e,r,s){function n(t,e){for(var i in e)t=t.replace(new RegExp("\\${"+i+"}","g"),e[i]);return t}var f=["ST_PH","el","container","panel"],a=function(t,e){if(t&&"object"==typeof t)for(var i in t)"string"==typeof t[i]?t[i]=n(t[i],e):o.isArray(t[i])?a(t[i],e):"object"==typeof t[i]&&a(t[i],e)};return e.extend({constructor:function(t){var e=this;e.data={},e.options=t,e.ctx=t&&t.ctx,e._sfmUtil=s;var i=e.getSfmUtil().getMainWin();e._sfmgEvent=i.SFM.sfmgEvent,e._sfmEvent=o.extend(!0,{},r),e._dataMgr=i.SFM.sfmDataMgr,e._moduleMgr=i.SFM.sfmModuleMgr;var n=e._t=e.getSfmUtil().fguid()+"_"+(new Date).getTime();e._id=e.__className__+"_"+n,e._mk=t&&t.mk,e._up=e.getSfmUtil().getUrlParams(e.ctx),e.config={},e.__init__(t),t&&t.el&&(e._el=t.el),e._onModuleInited()},destroy:function(){this.removeAllAction(),delete this.data,delete this._moduleMgr,delete this._dataMgr,delete this._sfmEvent,delete this._sfmgEvent,delete this._sfmUtil},initConfig:function(){return this._initConfig()},render:function(){return this._onModuleRendered(),this},resize:function(){return this},show:function(){return this},getSfmUtil:function(){return this.ctx&&this.ctx.SFM.sfmUtil||this._sfmUtil},getSfmEvent:function(t){return t?this._sfmgEvent:this._sfmEvent},getSfmDataMgr:function(){return this._dataMgr},getSfmModuleMgr:function(){return this._moduleMgr},getId:function(t){return null!=t?t+"_"+this._id:this._id},getServiceUrl:function(t,e){var i=this.getSfmModuleMgr();return i&&i.getServiceUrl(t,e)},ajax:function(t){var e=o.extend({type:"GET",dataType:"json",async:!0,cache:!1},t);return"POST"==e.type&&!1===e.fFormParam&&(e.data&&(e.data=JSON.stringify(e.data)),e.contentType="application/json",e.processData=!1),o.ajax(e)},addAction:function(t,e,i){return this.getSfmDataMgr().addAction(t,e,this,this._t,i),this},removeAction:function(t){return this.getSfmDataMgr().removeAction(t,this,this._t),this},removeAllAction:function(){return this.getSfmDataMgr().removeAllAction(this,this._t),this},doAction:function(){return this.getSfmDataMgr().doAction.apply(this,arguments)},getConfig:function(t,e){if(e){var i=t?this._dhc:this._hc;if(!i){i=this.getConfig(!0);for(var n={},r=0;r<f.length;r++)n[f[r]]=i[f[r]],delete i[f[r]];try{a(i,n.ST_PH);for(r=0;r<f.length;r++)i[f[r]]=n[f[r]];this[t?"_dhc":"_hc"]=i}catch(t){i={}}}return t?o.extend(!0,{},i):i}return this.data._config||(this.data._config=o.extend(!0,{},this.config)),t?o.extend(!0,{},this.data._config):this.config},getConfigItem:function(t,e){var i=this.getConfig(e),n=this.getSfmUtil().attr(i,t);if(null!=n&&i.ST_PH)for(var r in i.ST_PH)n=n.replace(new RegExp("\\${"+r+"}","g"),i.ST_PH[r]);return n},closeSelf:function(){this.getSfmModuleMgr().destroyModule({mid:this.getId()},"null"!=this.getConfig().region)},jq:function(t,e){var i=this,n=i._el;return null!=e?e.find(i.getId(t)):n?n.find(i.getId(t)):null},j:function(t,e){var i="#"+this.getPrefix()+"_"+t;return this.jq(i,e)},getPrefix:function(){if(this._prefix)return this._prefix;var t=this.__className__;return this._prefix=t[0].toLowerCase()+t.substr(1)},__init__:function(t){var e=this,i=e._mk=e._mk||null!==e._mk&&e._up&&e._up.mk;return i&&(e._md=e.getSfmDataMgr().getData("moduleData."+i),e._el=e._md&&e._md.el),e._loadRes(),e},_loadRes:function(){var t=this,e=t._md;if(e){var i=e.url;if(i.lastIndexOf(".js")==i.length-3){if(e.style&&t._el){var n=t.getSfmUtil().getHostUrl(t.getSfmUtil().getMainWin())+e.style;t.getSfmModuleMgr()._getMainCtnr().contents().find("head").append('<link type="text/css" rel="stylesheet" href="'+n+'"></link>')}return}}var r=t.getSfmDataMgr().getData("sysConfig.theme");t.getSfmUtil().loadThemeStyle(r);var o=t.getSfmDataMgr().getData("sysConfig.project");return t.getSfmUtil().load("/projects/"+o+"/app.css"),e&&(e.style&&t.getSfmUtil().load(e.style),e.config&&t.getSfmUtil().load(e.config),e.lib&&t.getSfmUtil().load.apply(this,e.lib)),t},_initConfig:function(){var t=this,e=t._md,i=e&&e.mp,n=t.getSfmDataMgr().getData("sysConfig.moduleConfig"),r=window.mconfig||t._mk&&window["sfmconfig"+t._mk];return o.extend(!0,t.config,n,r,i),t},_onModuleInited:function(){var t=this._md&&this._md.onModuleInited;return"function"==typeof t&&t(this),this},_onModuleRendered:function(){var t=this._md&&this._md.onModuleRendered;return"function"==typeof t&&t(this),this},__className__:"SfmModuleBase",version:"0.1.0"})},window);

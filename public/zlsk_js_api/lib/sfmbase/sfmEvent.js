!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=t(require("underscore")):"function"==typeof define&&define.amd?define(["underscore"],t):(null==e.SFM&&(e.SFM={}),e.SFM.sfmEvents=t(_))}(function(h){var s=Array.prototype.slice,e={on:function(t,e,n){return u(this,"on",t,[e,n])&&e&&(this._events||(this._events={}),(this._events[t]||(this._events[t]=[])).push({callback:e,context:n,ctx:n||this})),this},once:function(t,e,n){if(!u(this,"once",t,[e,n])||!e)return this;var i=this,s=h.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n)},off:function(t,e,n){var i,s,r,c,o,l,f,a;if(!this._events||!u(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(o=0,l=(c=t?[t]:h.keys(this._events)).length;o<l;o++)if(t=c[o],r=this._events[t]){if(this._events[t]=i=[],e||n)for(f=0,a=r.length;f<a;f++)s=r[f],(e&&e!==s.callback&&e!==s.callback._callback||n&&n!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!u(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&r(n,e),i&&r(i,arguments),this},stopListening:function(t,e,n){var i=this._listeningTo;if(!i)return this;var s=!e&&!n;for(var r in n||"object"!=typeof e||(n=this),t&&((i={})[t._listenId]=t),i)(t=i[r]).off(e,n,this),(s||h.isEmpty(t._events))&&delete this._listeningTo[r];return this}},l=/\s+/,u=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var s in n)t[e].apply(t,[s,n[s]].concat(i));return!1}if(l.test(n)){for(var r=n.split(l),c=0,o=r.length;c<o;c++)t[e].apply(t,[r[c]].concat(i));return!1}return!0},r=function(t,e){var n,i=-1,s=t.length,r=e[0],c=e[1],o=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,c);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,c,o);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e)}};return h.each({listenTo:"on",listenToOnce:"once"},function(s,t){e[t]=function(t,e,n){var i=this._listeningTo||(this._listeningTo={});return n||"object"!=typeof e||(n=this),(i[t._listenId||(t._listenId=h.uniqueId("l"))]=t)[s](e,n,this),this}}),e.bind=e.on,e.unbind=e.off,e},window);
